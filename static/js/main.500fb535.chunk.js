(this.webpackJsonpcatreact=this.webpackJsonpcatreact||[]).push([[0],{77:function(t,e,n){t.exports=n(93)},88:function(t,e,n){},89:function(t,e,n){},93:function(t,e,n){"use strict";n.r(e);var r=n(4),a=n.n(r),c=n(11),o=n(2),i=n.n(o),u=n(36),l=n.n(u),s=n(7),d=n(10),p=n(15),f=n(16),v=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(t){var r;return Object(s.a)(this,n),(r=e.call(this,t)).state={hasError:!1},r}return Object(d.a)(n,[{key:"componentDidCatch",value:function(t,e){}},{key:"render",value:function(){return this.state.hasError?i.a.createElement("h1",null,"Something went wrong."):this.props.children}}],[{key:"getDerivedStateFromError",value:function(t){return{hasError:!0}}}]),n}(i.a.Component),b=n(19),h=n(25),m=n(30),O=n(6),j=n(45),k=n(5),g=function(t){var e=t.url;return Object(o.useEffect)((function(){}),[]),i.a.createElement("img",{style:{height:"20em"},src:e,alt:""})},y=Object(b.b)({key:"cards",default:[]}),w=Object(b.c)({key:"card",default:{id:"",url:"",points:0,vote:0}}),E=Object(b.b)({key:"selectedCardId",default:null}),C=(Object(b.d)({key:"selectedCard",get:function(t){var e=t.get,n=e(E);if(null!=n)return e(w(n))},set:function(t,e){var n=t.set,r=(0,t.get)(E);null!=r&&n(w(r),e)}}),function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(t=e.call.apply(e,[this].concat(a))).state={active:!1},t.handleClick=function(){t.props.onHandleClick()},t.toggleActive=function(){t.setState({active:!t.state.active})},t}return Object(d.a)(n,[{key:"render",value:function(){var t=this;return i.a.createElement("button",{onClick:function(){t.toggleActive(),t.handleClick()}},this.props.value)}}]),n}(o.Component)),x=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(t=e.call.apply(e,[this].concat(a))).state={active:!1,icon:""},t}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement(C,{onHandleClick:this.props.onHandleClick,value:"Up Vote"})}}]),n}(o.Component),A=function(t){Object(p.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(t=e.call.apply(e,[this].concat(a))).state={active:!1,icon:""},t}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement(C,{onHandleClick:this.props.onHandleClick,value:"Down Vote"})}}]),n}(o.Component);function D(){var t=Object(j.a)(["\nmutation ($id: ObjectId!, $points: Int!){\n    updateOneCard(\n        query: {_id: $id}\n        set: {points: $points}\n    ) {\n        points\n    }\n}"]);return D=function(){return t},t}var H=Object(h.gql)(D());var _=function(t){var e=t.id,n=Object(h.useMutation)(H),r=Object(O.a)(n,2),a=r[0],c=(r[1].data,Object(b.e)(w(e))),o=Object(O.a)(c,2),u=o[0],l=o[1],s=function(t){new Promise((function(e,n){switch(u.vote){case 0:e(t?{points:u.points+1,vote:1}:{points:u.points-1,vote:-1});break;case 1:e(t?{points:u.points-1,vote:0}:{points:u.points-2,vote:-1});break;case-1:e(t?{points:u.points+2,vote:1}:{points:u.points+1,vote:0});break;default:n("Unable to vote")}})).then((function(t){var e=t.points,n=t.vote;l(Object(k.a)(Object(k.a)({},u),{},{points:e,vote:n})),a({variables:{id:u.id,points:e}})})).catch(console.error)},d={color:["red","black","green"][u.vote+1]};return i.a.createElement("div",{style:{display:"flex",flexFlow:"row",justifyContent:"space-between",alignSelf:"center",width:"20em"}},i.a.createElement(x,{onHandleClick:function(){s(1)}}),i.a.createElement("strong",{style:d},u.points),i.a.createElement(A,{onHandleClick:function(){s(0)}}))},S=function(t){var e=t.cardData,n=Object(b.e)(w(e._id)),r=Object(O.a)(n,2),a=r[0],c=r[1];return Object(o.useEffect)((function(){c(Object(k.a)(Object(k.a)({},a),{},{id:e._id,url:e.url,points:e.points,vote:0}))}),[]),i.a.createElement("div",null,i.a.createElement(g,{url:e.url}),i.a.createElement(_,{id:a.id}))};function $(){var t=Object(j.a)(["\nmutation AddCard($url: String!) {\n\tinsertOneCard(\n\t\tdata: {\n\t\t\turl: $url,\n\t\t\tpoints: 0\n\t\t}\n\t) {\n\t\t_id\n\t\turl\n\t\tpoints\n\t}\n}"]);return $=function(){return t},t}function q(){var t=Object(j.a)(["\nquery GetCards {\n\tcards {\n\t\t_id\n\t\turl\n\t\tpoints\n\t}\n}"]);return q=function(){return t},t}var I=Object(h.gql)(q()),U=Object(h.gql)($());var F=function(){var t=Object(h.useMutation)(U),e=Object(O.a)(t,2),n=e[0],r=(e[1].addedCardData,Object(h.useQuery)(I)),o=r.loading,u=r.error,l=r.data,s=Object(b.e)(y),d=Object(O.a)(s,2),p=d[0],f=d[1],v=function(){var t=Object(c.a)(a.a.mark((function t(){var e;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://api.thecatapi.com/v1/images/search?size=full");case 2:return e=t.sent,t.next=5,e.json();case 5:e=t.sent,n({variables:{url:e[0].url}}).then((function(t){var e=t.data.insertOneCard,n=i.a.createElement(S,{key:e._id,cardData:e});f([n].concat(Object(m.a)(p)))})).catch(console.error);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return o?i.a.createElement("div",null,"Loading ..."):u?i.a.createElement("div",null,"Error: ",u.message):i.a.createElement("div",null,i.a.createElement("button",{onClick:v},"Fetch cat"),i.a.createElement("div",null,p),l.cards.map((function(t){return console.log(t),i.a.createElement(S,{key:t._id,cardData:t})})).reverse())};n(88),n(89),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var B=n(59),M=new B.a("catreact-lkwiu");function P(){return z.apply(this,arguments)}function z(){return(z=Object(c.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M.currentUser){t.next=5;break}return t.next=3,M.logIn(B.b.anonymous());case 3:t.next=7;break;case 5:return t.next=7,M.currentUser.refreshCustomData();case 7:return t.abrupt("return",M.currentUser.accessToken);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var J=new h.ApolloClient({link:new h.HttpLink({uri:"https://realm.mongodb.com/api/client/v2.0/app/".concat("catreact-lkwiu","/graphql"),fetch:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=Object(c.a)(a.a.mark((function t(e,n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P();case 2:return r=t.sent,n.headers.Authorization="Bearer ".concat(r),t.abrupt("return",fetch(e,n));case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}),cache:new h.InMemoryCache({typePolicies:{Cards:{keyFields:["_id","url","points"]}}})});l.a.render(i.a.createElement(v,null,i.a.createElement(b.a,null,i.a.createElement(h.ApolloProvider,{client:J},i.a.createElement(F,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[77,1,2]]]);
//# sourceMappingURL=main.500fb535.chunk.js.map